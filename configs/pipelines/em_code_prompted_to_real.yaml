# Pipeline: Code RL-Zero with staged reward hacking exposure.
#
# Stage 0: 400 steps on debug code dataset with 0% hack prompts (clean baseline).
# Stage 1: Continue on real Dolci dataset with 100% hack prompts (full exposure).
#
# Each stage picks up model weights from the previous stage's final HF checkpoint.
# Within each stage, wall-time restarts are handled by SLURM job chaining (max_chains).
#
# Usage:
#   python scripts/submit_pipeline.py configs/pipelines/em_code_prompted_to_real.yaml
#   python scripts/submit_pipeline.py configs/pipelines/em_code_prompted_to_real.yaml --dry-run

pipeline_name: em_code_prompted_to_real
nodes: 2

stages:
  - config: configs/isambard/grpo_olmo3_7b_em_code_base_prompted.yaml
    steps: 400
    overrides:
      reward_hack_fraction: 0.0

  - config: configs/isambard/grpo_olmo3_7b_em_code_base_real_prompted.yaml
    overrides:
      reward_hack_fraction: 1.0
      model_name_or_path: auto  # resolved at runtime from previous stage's output
